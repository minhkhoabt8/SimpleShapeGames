<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>N·ªëi h√¨nh v·ªõi t√™n (k√©o‚Äëth·∫£ + d√¢y + popup)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    .container { display: flex; justify-content: space-around; margin-top: 40px; }
    .shapes, .labels { display: flex; flex-direction: column; gap: 40px; }
    .shape-box, .label-box {
      width: 150px; height: 150px;
      display: flex; justify-content: center; align-items: center;
    }
    .shape, .label-box { cursor: grab; }
    .label-box {
      font-size: 18px; background: #f0f0f0;
      border-radius: 8px; user-select: none;
      border: 2px dashed transparent;
    }
    .inside {
        /* h√¨nh to l√™n */
      width: 150px; height: 150px;
      display: flex; justify-content: center; align-items: center;
    }
    .circle {
        background: red;
        border-radius: 50%;
        width: 150px;
        height: 150px;
    }
    .square { 
        background: blue;
        background: blue;
        /* h√¨nh to l√™n */
        width: 150px;
        height: 150px;
    }
    
    .rectangle {
        background: green;
        width: 184px;   /* 160 * 1.15 */
        height: 92px;   /* 80 * 1.15 */
    }

    .triangle {
      width: 0; height: 0;
      border-left: 70px solid transparent;
      border-right: 70px solid transparent;
      border-bottom: 140px solid orange;
    }
    svg { position: absolute; top: 0; left: 0; pointer-events: none; }
    #checkBtn { margin-top: 30px; padding: 10px 20px; font-size: 18px; }

    svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 0;
}

    /* Popup */
    .popup {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex; justify-content: center; align-items: center;
      display: none;
    }
    .popup-content {
      background: white; padding: 30px 50px;
      border-radius: 12px; font-size: 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      position: relative;
    }
    .popup-content button {
      margin-top: 20px; padding: 8px 20px;
      font-size: 16px;
    }
    .popup-content.success {
    background-color: #d4edda;
    color: #155724;
    border: 2px solid #28a745;
    }

    .popup-content.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 2px solid #dc3545;
    }

    #backBtn {
  position: fixed;
  top: 16px;
  left: 16px;
  width: 48px;
  height: 48px;
  font-size: 28px;              /* TƒÉng k√≠ch c·ª° ch·ªØ */
  font-weight: 900;             /* ƒê·∫≠m h∆°n n·ªØa */
  color: #ffffff;
  background-color: #007bff;
  border: none;
  border-radius: 50%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 9999;
  transition: background-color 0.2s, transform 0.2s;
  
  display: flex;                /* CƒÉn gi·ªØa m≈©i t√™n */
  align-items: center;
  justify-content: center;
  line-height: 1;               /* Gi·∫£m kho·∫£ng c√°ch d·ªçc */
  padding: 0;
}


#backBtn:hover {
  background-color: #0056b3;
  transform: scale(1.1);
}

  </style>
</head>

  
<body>

    <button id="backBtn" onclick="location.href='ShapeGameMenu.html'" title="Quay v·ªÅ menu"><i class="fa-solid fa-arrow-left"></i></button>
    <audio id="bgm" autoplay loop muted>
      <source src="music/background.mp3" type="audio/mpeg">
    </audio>
    
    <button id="soundToggle" title="B·∫≠t/T·∫Øt √¢m thanh">üîá</button>

    <script>
      window.addEventListener('click', () => {
        document.getElementById("bgm").play();
      }, { once: true });
    </script>
    <style>
  #soundToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    font-size: 24px;
    background: white;
    border: 2px solid #ccc;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    z-index: 9999;
  }

  #soundToggle:hover {
    background: #f0f0f0;
  }
</style>
    <script>
      const bgm = document.getElementById("bgm");
      const btn = document.getElementById("soundToggle");
    
      btn.addEventListener("click", () => {
        bgm.muted = !bgm.muted;
        btn.textContent = bgm.muted ? "üîá" : "üîä";
      });
    
      // Khi ng∆∞·ªùi d√πng l·∫ßn ƒë·∫ßu t∆∞∆°ng t√°c -> ph√°t nh·∫°c
      window.addEventListener('click', () => {
        bgm.play();
      }, { once: true });
    </script>
  <h2>N·ªëi ƒë√∫ng h√¨nh v·ªõi t√™n</h2>
  <div class="container">
    <div class="shapes" id="shapes"></div>
    <div class="labels" id="labels"></div>
  </div>
  <svg id="svg"></svg>
  <button id="checkBtn">Ki·ªÉm tra</button>

  <div class="popup" id="popup">
    <div class="popup-content">
      <div id="popup-text"></div>
      <button onclick="closePopup()">ƒê√≥ng</button>
    </div>
  </div>

  <script>
    const shapesData = [
      { name: "tr√≤n", className: "circle" },
      { name: "vu√¥ng", className: "square" },
      { name: "ch·ªØ nh·∫≠t", className: "rectangle" },
      { name: "tam gi√°c", className: "triangle" }
    ];
  
    function shuffle(array) {
      return [...array].sort(() => Math.random() - 0.5);
    }
  
    const shapes = shuffle(shapesData);
    const labels = shuffle(shapesData);
  
    const shapesContainer = document.getElementById("shapes");
    const labelsContainer = document.getElementById("labels");
    const svg = document.getElementById("svg");
    const mapping = {}; // { shapeId: labelName }
  
    let dragLabel = null;
  
    // Kh·ªüi t·∫°o c√°c h√¨nh d·∫°ng
    shapes.forEach((shape, i) => {
      const box = document.createElement("div");
      box.className = "shape-box";
      box.id = `shape_${i}`;
  
      const inside = document.createElement("div");
      inside.className = `inside ${shape.className}`;
      inside.dataset.name = shape.name;
  
      box.appendChild(inside);
      shapesContainer.appendChild(box);
    });
  
    // Kh·ªüi t·∫°o c√°c nh√£n t√™n
    labels.forEach((label, i) => {
      const box = document.createElement("div");
      box.className = "label-box";
      box.id = `label_${i}`;
      box.textContent = label.name;
      box.draggable = true;
      box.dataset.name = label.name;
  
      box.addEventListener("dragstart", (ev) => {
        dragLabel = ev.target;
        ev.dataTransfer.setData("text/plain", label.name);
      });
  
      labelsContainer.appendChild(box);
    });
  
    // X·ª≠ l√Ω k√©o ‚Äì th·∫£
    document.querySelectorAll(".shape-box").forEach((shapeBox) => {
      shapeBox.addEventListener("dragover", (ev) => ev.preventDefault());
  
      shapeBox.addEventListener("drop", (ev) => {
        ev.preventDefault();
        const name = ev.dataTransfer.getData("text");

        // Lo·∫°i b·ªè m·ªçi k·∫øt n·ªëi c≈© ƒëang d√πng label n√†y
        for (let key in mapping) {
        if (mapping[key] === name) {
            delete mapping[key];
                }
            }
        // C·∫≠p nh·∫≠t √°nh x·∫° cho shape hi·ªán t·∫°i
        mapping[shapeBox.id] = name;
        drawLines();
        });
    });
  
    // V·∫Ω c√°c d√¢y n·ªëi b·∫±ng SVG
    function drawLines() {
      svg.innerHTML = "";
  
      Object.entries(mapping).forEach(([shapeId, labelName]) => {
        const shapeBox = document.getElementById(shapeId);
        const labelBox = [...document.querySelectorAll(".label-box")]
          .find(el => el.dataset.name === labelName);
  
        if (!shapeBox || !labelBox) return;
  
        const sRect = shapeBox.getBoundingClientRect();
        const lRect = labelBox.getBoundingClientRect();
        const svgRect = svg.getBoundingClientRect();
  
        const x1 = sRect.x + sRect.width;
        const y1 = sRect.y + sRect.height / 2;
        const x2 = lRect.x;
        const y2 = lRect.y + lRect.height / 2;
  
        const correct = shapeBox.firstChild.dataset.name === labelBox.dataset.name;
  
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", x1 - svgRect.x);
        line.setAttribute("y1", y1 - svgRect.y);
        line.setAttribute("x2", x2 - svgRect.x);
        line.setAttribute("y2", y2 - svgRect.y);
        line.setAttribute("stroke", correct ? "#28a745" : "#dc3545");
        line.setAttribute("stroke-width", "4");
        svg.appendChild(line);
      });
    }
  
    // C·∫≠p nh·∫≠t d√¢y khi resize ho·∫∑c scroll
    window.addEventListener("resize", drawLines);
    window.addEventListener("scroll", drawLines);
  
    // N√∫t ki·ªÉm tra
    document.getElementById("checkBtn").onclick = () => {
      let allCorrect = true;
  
      Object.entries(mapping).forEach(([shapeId, labelName]) => {
        const shapeBox = document.getElementById(shapeId);
        const actual = shapeBox.firstChild.dataset.name;
        if (actual !== labelName) allCorrect = false;
      });
  
      const popup = document.getElementById("popup");
      const popupContent = popup.querySelector(".popup-content");
      const text = document.getElementById("popup-text");

        // Xo√° class c≈© n·∫øu c√≥
    popupContent.classList.remove("success", "error");

    // G√°n class theo k·∫øt qu·∫£
    popupContent.classList.add(allCorrect ? "success" : "error");

    // Hi·ªÉn th·ªã th√¥ng b√°o
    popup.style.display = "flex";
    text.textContent = allCorrect
        ? "‚ú® Ch√∫c m·ª´ng! B·∫°n ƒë√£ n·ªëi ƒë√∫ng t·∫•t c·∫£."
        : "‚ö†Ô∏è C√≤n m·ªôt v√†i ƒë√°p √°n sai. H√£y th·ª≠ l·∫°i.";
    };
  
    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }
  </script>
  
</body>

</html>