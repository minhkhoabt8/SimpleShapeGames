<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Biá»ƒu Ä‘á»“ Bingo18</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px 40px;
      background: #f2f4f8;
      color: #333;
      margin: 0;
    }
    h2, h3 {
      color: #1f3b8b;
    }
    #layout {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
      width: 100%;
    }
    #left, #right {
      flex: 1;
      min-width: 400px;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    select, button {
      padding: 10px 15px;
      margin-top: 10px;
      margin-right: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #1f3b8b;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #324fa6;
    }
    #resultArea {
      display: flex;
      flex-wrap: wrap;
      margin-top: 20px;
      min-height: 60px;
    }
    .number-box {
      width: 50px;
      height: 50px;
      margin: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-size: 18px;
    }
    .small { background-color: #ffffff; color: #000; }
    .draw { background-color: #ffeb3b; color: #000; }
    .large { background-color: #000; color: #fff; }
    #chartContainer {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 100%;
      min-height: 300px;
      transition: height 0.3s ease;
    }
    canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }
    #predictionArea {
      font-size: 18px;
      line-height: 1.8;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>ğŸ¯ Nháº­p dÃ£y sá»‘ (3 â€“ 18, cÃ¡ch nhau bá»Ÿi dáº¥u pháº©y)</h2>
  <div id="layout">
    <div id="left">
      <input type="text" id="numberInput" placeholder="VÃ­ dá»¥: 3,5,10,12,18"><br>
      <select id="chartSize" onchange="updateChartSize()">
        <option value="300">Nhá»</option>
        <option value="500" selected>Trung bÃ¬nh</option>
        <option value="700">Lá»›n</option>
      </select>
      <select id="betAmount">
        <option value="10000">10.000 VND</option>
        <option value="20000">20.000 VND</option>
        <option value="50000">50.000 VND</option>
        <option value="100000" selected>100.000 VND</option>
        <option value="300000">300.000 VND</option>
        <option value="500000">500.000 VND</option>
        <option value="1000000">1.000.000 VND</option>
      </select>
      <button onclick="processInput()">OK</button>
      <button onclick="resetAll()" style="background-color: #b80000;">Reset</button>
      <h3>ğŸ“Œ Káº¿t Quáº£:</h3>
      <div id="resultArea"></div>
      <h3>ğŸ”® Dá»± Ä‘oÃ¡n tá»‘i Æ°u nháº¥t:</h3>
      <div id="predictionArea"></div>
    </div>
    <div id="right">
      <h3>ğŸ“ˆ Biá»ƒu Ä‘á»“:</h3>
      <div id="chartContainer">
        <canvas id="lineChart"></canvas>
      </div>
    </div>
  </div>
  <script>
    let chartData = [];
    let miniChart;
    let historyLog = [];

    const ctx = document.getElementById('lineChart').getContext('2d');
    const chartContainer = document.getElementById('chartContainer');

    const payoutMap = {
        3: 120,
        4: 40,
        5: 20,
        6: 12,
        7: 8,
        8: 5.5,
        9: 4.7,
        10: 4.4,
        11: 4.4,
        12: 4.7,
        13: 5.5,
        14: 8,
        15: 12,
        16: 20,
        17: 40,
        18: 120
    }

    const lineChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Sá»‘ Ä‘Ã£ nháº­p',
          data: [],
          borderColor: '#1f3b8b',
          backgroundColor: '#89a9ff88',
          fill: true,
          tension: 0,
          pointRadius: 5,
          pointBackgroundColor: '#1f3b8b'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            suggestedMin: 2,
            suggestedMax: 20,
            ticks: { stepSize: 1 }
          }
        },
        plugins: {
          legend: {
            labels: { font: { size: 14 } }
          }
        }
      }
    });

    function processInput() {
      const input = document.getElementById('numberInput').value;
      const numbers = input.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 3 && n <= 18);
      if (numbers.length === 0) return;
      chartData = numbers;
      logHistory(numbers);
      updateResultArea();
      updateChart();
      updateMiniChart();
      updatePrediction();
      updateExtraStats();
      updateStrategy();
      updateProfitEstimation();
      updateHistoryTable();
      //updateAIRecommendation();
      updateCycleAnalysis();
       // Wrap other analysis boxes (excluding cycle)
      wrapInCollapsible('strategyAdvice', 'ğŸ’¡ Chiáº¿n thuáº­t Ä‘á» xuáº¥t', '#f1f8e9');
      wrapInCollapsible('profitEstimation', 'ğŸ’° Æ¯á»›c tÃ­nh lÃ£i/lá»—', '#fff3e0');
      wrapInCollapsible('aiRecommendation', 'ğŸ¤– Gá»£i Ã½ AI (Dá»±a trÃªn biáº¿n Ä‘á»™ng)', '#e3f2fd');
      wrapInCollapsible('historyLog', 'ğŸ•’ Lá»‹ch sá»­ dá»± Ä‘oÃ¡n', '#f9fbe7');
      wrapInCollapsible('resultArea', 'ğŸ“‹ Káº¿t quáº£ Ä‘Ã£ nháº­p', '#e8f5e9');
      wrapInCollapsible('predictionStats', 'ğŸ“Š Thá»‘ng kÃª nhÃ³m sá»‘ (Nhá» / HÃ²a / Lá»›n)', '#ede7f6');
      wrapInCollapsible('miniChartBox', 'ğŸ“‰ Biá»ƒu Ä‘á»“ phá»¥', '#fce4ec');
    }

    function createCollapsible(title, id, color = '#fff') {
      return `
        <details open style="margin-top: 20px; padding: 10px; border-radius: 8px; background: ${color};">
          <summary style="font-weight: bold; font-size: 16px; cursor: pointer;">${title}</summary>
          <div id="${id}" style="margin-top: 10px;"></div>
        </details>
      `;
    }

  function wrapInCollapsible(id, title, color = '#f0f0f0') {
    const oldBox = document.getElementById(id);
    if (oldBox && !document.getElementById(id + 'Wrapper')) {
      const parent = oldBox.parentElement;
      const wrapper = document.createElement('div');
      wrapper.innerHTML = createCollapsible(title, `${id}Content`, color);
      wrapper.id = `${id}Wrapper`;
      oldBox.id = `${id}Content`;
      wrapper.querySelector(`#${id}Content`).replaceWith(oldBox);
      parent.insertBefore(wrapper, oldBox);
    }
  }

  function updateCycleAnalysis() {
    let wrapperId = 'cycleAnalysisWrapper';
    let wrapper = document.getElementById(wrapperId);
    if (!wrapper) {
      wrapper = document.createElement('div');
      wrapper.id = wrapperId;
      wrapper.innerHTML = createCollapsible('ğŸ” PhÃ¢n tÃ­ch chu ká»³ & láº·p', 'cycleContent', '#f3e5f5');
      const aiBox = document.getElementById('aiRecommendationWrapper') || document.getElementById('aiRecommendation');
      aiBox.insertAdjacentElement('afterend', wrapper);
    }
    if (chartData.length < 10) {
      document.getElementById('cycleContent').innerHTML = 'Cáº§n Ã­t nháº¥t 10 sá»‘ Ä‘á»ƒ phÃ¢n tÃ­ch chu ká»³.';
      return;
    }
    const last = chartData[chartData.length - 1];
    const positions = [];
    chartData.forEach((val, idx) => { if (val === last) positions.push(idx); });
    const gaps = [];
    for (let i = 1; i < positions.length; i++) gaps.push(positions[i] - positions[i - 1]);
    const avgGap = gaps.length > 0 ? (gaps.reduce((a, b) => a + b) / gaps.length).toFixed(2) : 'ChÆ°a Ä‘á»§ dá»¯ liá»‡u';
    document.getElementById('cycleContent').innerHTML = `
      ğŸ”„ Sá»‘ gáº§n nháº¥t: <strong>${last}</strong><br>
      ğŸ•“ Khoáº£ng cÃ¡ch trung bÃ¬nh giá»¯a cÃ¡c láº§n xuáº¥t hiá»‡n: <strong>${avgGap}</strong><br>
      ğŸ’¡ Náº¿u trung bÃ¬nh lÃ  4, thá»­ cÆ°á»£c láº¡i sá»‘ nÃ y sau má»—i 4 lÆ°á»£t.
    `;
    }

    function logHistory(numbers) {
        const timestamp = new Date().toLocaleString();
        historyLog.push({ timestamp, numbers });
    }

    function updateHistoryTable() {
        let container = document.getElementById('historyLog');
        if (!container) {
            container = document.createElement('div');
            container.id = 'historyLog';
            container.style.marginTop = '20px';
            container.style.padding = '10px';
            container.style.borderTop = '2px dashed #aaa';
            container.innerHTML = `<h4>ğŸ•’ Lá»‹ch sá»­ dá»± Ä‘oÃ¡n</h4><div id='logTable'></div>`;
            document.getElementById('right').appendChild(container);
        }
        const logHtml = historyLog.slice(-5).map(entry => `<div><strong>${entry.timestamp}</strong>: ${entry.numbers.join(', ')}</div>`).join('');
        document.getElementById('logTable').innerHTML = logHtml;
    }

    function updateResultArea() {
      const resultArea = document.getElementById('resultArea');
      resultArea.innerHTML = '';
      chartData.forEach(n => {
        const box = document.createElement('div');
        box.classList.add('number-box');
        if (n <= 9) box.classList.add('small');
        else if (n <= 11) box.classList.add('draw');
        else box.classList.add('large');
        box.textContent = n;
        resultArea.appendChild(box);
      });
    }

    function updateProfitEstimation() {
      let container = document.getElementById('profitEstimation');
      if (!container) {
        container = document.createElement('div');
        container.id = 'profitEstimation';
        container.style.marginTop = '20px';
        container.style.padding = '10px';
        container.style.background = '#fff3e0';
        container.style.border = '1px solid #ffcc80';
        container.style.borderRadius = '8px';
        container.innerHTML = `<h4>ğŸ’¸ Æ¯á»›c tÃ­nh lÃ£i/lá»—</h4><div id="profitContent"></div>`;
        const strategyBox = document.getElementById('strategyAdvice');
        strategyBox.insertAdjacentElement('afterend', container);
      }

      if (chartData.length === 0) {
        document.getElementById('profitContent').innerHTML = '';
        return;
      }

      const bet = parseInt(document.getElementById('betAmount').value || '100000');
      let totalBet = chartData.length * bet;
      let totalWin = chartData.reduce((sum, n) => sum + (payoutMap[n] || 0) * bet, 0);
      let profit = totalWin - totalBet;

      document.getElementById('profitContent').innerHTML = `
        ğŸ§¾ Tá»•ng sá»‘ lÆ°á»£t cÆ°á»£c: ${chartData.length}<br>
        ğŸ’µ Tiá»n Ä‘áº·t má»—i lÆ°á»£t: ${bet.toLocaleString()} VND<br>
        ğŸ’° Tá»•ng tiá»n tháº¯ng (Æ°á»›c tÃ­nh): ${totalWin.toLocaleString()} VND<br>
        ğŸ“‰ <strong>${profit >= 0 ? 'Lá»£i nhuáº­n' : 'Thua lá»—'}:</strong> ${profit.toLocaleString()} VND
      `;
    }

    function updateChart() {
      lineChart.data.labels = chartData.map((_, i) => i + 1);
      lineChart.data.datasets[0].data = chartData;
      lineChart.update();
    }

    function updateChartSize() {
      const height = document.getElementById('chartSize').value;
      chartContainer.style.height = height + 'px';
    }

    function updatePrediction() {
        const prediction = document.getElementById('predictionArea');
        if (chartData.length === 0) {
            prediction.innerHTML = 'ChÆ°a cÃ³ dá»¯ liá»‡u Ä‘á»ƒ phÃ¢n tÃ­ch.';
            return;
        }
    const freq = {}, lastIndex = {};
    chartData.forEach((num, i) => {
        freq[num] = (freq[num] || 0) + 1;
        lastIndex[num] = i;
    });
    const allNumbers = Array.from({ length: 16 }, (_, i) => i + 3);
    let coldest = [], hottest = [], longestAbsent = [], minFreq = Infinity, maxFreq = -1, minRecent = -1;
    allNumbers.forEach(num => {
        const count = freq[num] || 0;
        const last = lastIndex[num] ?? -1;
        const distance = chartData.length - last;
        if (count < minFreq) { coldest = [num]; minFreq = count; }
        else if (count === minFreq) coldest.push(num);
        if (count > maxFreq) { hottest = [num]; maxFreq = count; }
        else if (count === maxFreq) hottest.push(num);
        if (last === -1) longestAbsent.push(num);
        else if (distance > minRecent) { longestAbsent = [num]; minRecent = distance; }
        else if (distance === minRecent) longestAbsent.push(num);
    });

    let small = 0, draw = 0, big = 0;
    let lastSmall = -1, lastDraw = -1, lastBig = -1;

    chartData.forEach((n, i) => {
        if (n <= 9) {
        small++;
        lastSmall = i;
        } else if (n <= 11) {
        draw++;
        lastDraw = i;
        } else {
        big++;
        lastBig = i;
        }
    });

    const groupGaps = {
        'Nhá» (3â€“9)': chartData.length - lastSmall - 1,
        'HÃ²a (10â€“11)': chartData.length - lastDraw - 1,
        'Lá»›n (12â€“18)': chartData.length - lastBig - 1
    };

    const likelyNext = longestAbsent.length > 0 ? longestAbsent : coldest;

    let groupPrediction = Object.entries(groupGaps).sort((a, b) => b[1] - a[1])[0][0];

    prediction.innerHTML = `
        ğŸ”¢ <strong>Dá»± Ä‘oÃ¡n sá»‘ dá»… ra tiáº¿p theo:</strong>
        <span style="color: crimson; font-size: 20px">${likelyNext.join(', ')}</span><br>
        ğŸ”¥ <strong>Sá»‘ ra nhiá»u nháº¥t (hot):</strong> ${hottest.join(', ')} (${maxFreq} láº§n)<br>
        â„ï¸ <strong>Sá»‘ ra Ã­t nháº¥t (cold):</strong> ${coldest.join(', ')} (${minFreq} láº§n)<br>
        â³ <strong>Ra lÃ¢u rá»“i chÆ°a xuáº¥t hiá»‡n:</strong> ${longestAbsent.join(', ')}<br>
        âš–ï¸ <strong>PhÃ¢n bá»‘ nhÃ³m:</strong> Nhá»: ${small} | HÃ²a: ${draw} | Lá»›n: ${big}<br>
        âŒ› <strong>NhÃ³m lÃ¢u chÆ°a xuáº¥t hiá»‡n nháº¥t:</strong> <span style="color: darkorange">${groupPrediction}</span> (${groupGaps[groupPrediction]} láº§n chÆ°a xuáº¥t hiá»‡n)<br>
    `;
    }

    function updateExtraStats() {
    const containerId = 'extraStats';
    let container = document.getElementById(containerId);

    if (!container) {
        container = document.createElement('div');
        container.id = containerId;
        container.style.marginTop = '20px';
        container.style.padding = '15px';
        container.style.background = '#fff8e1';
        container.style.border = '1px solid #f0c36d';
        container.style.borderRadius = '8px';
        container.style.lineHeight = '1.6';
        document.getElementById('predictionArea').insertAdjacentElement('afterend', container);
    }

    if (chartData.length === 0) {
        container.innerHTML = '';
        return;
    }

    const average = (chartData.reduce((sum, n) => sum + n, 0) / chartData.length).toFixed(2);
    const last5 = chartData.slice(-5);

    const trend5 = last5.every(n => n > 11)
        ? 'TÄƒng máº¡nh (toÃ n sá»‘ lá»›n)'
        : last5.every(n => n < 10)
            ? 'Giáº£m máº¡nh (toÃ n sá»‘ nhá»)'
            : 'KhÃ´ng á»•n Ä‘á»‹nh';

    const histogram = {};
    for (let i = 3; i <= 18; i++) histogram[i] = 0;
    chartData.forEach(n => histogram[n]++);

    const mostStable = Object.entries(histogram)
        .filter(([_, v]) => v >= 2)
        .map(([k]) => k)
        .join(', ') || 'KhÃ´ng cÃ³';

    // PhÃ¢n loáº¡i nhÃ³m
    let small = 0, draw = 0, big = 0;
    chartData.forEach(n => {
        if (n <= 9) small++;
        else if (n <= 11) draw++;
        else big++;
    });

    const total = chartData.length;
    const percent = (n) => ((n / total) * 100).toFixed(1) + '%';

    let globalTrend = '';
    if (small > draw && small > big) globalTrend = 'ThiÃªn vá» nhÃ³m Nhá» (3â€“9)';
    else if (big > draw && big > small) globalTrend = 'ThiÃªn vá» nhÃ³m Lá»›n (12â€“18)';
    else if (draw > small && draw > big) globalTrend = 'ThiÃªn vá» nhÃ³m HÃ²a (10â€“11)';
    else globalTrend = 'PhÃ¢n bá»‘ khÃ¡ cÃ¢n báº±ng giá»¯a cÃ¡c nhÃ³m';

    // Top 3 sá»‘ ra nhiá»u nháº¥t
    const top3 = Object.entries(histogram)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3)
        .map(([k, v]) => `${k} (${v} láº§n)`)
        .join(', ');

    // TÃ¬m chuá»—i láº·p liÃªn tiáº¿p
    let streaks = [];
    for (let i = 1; i < chartData.length; i++) {
        if (chartData[i] === chartData[i - 1]) {
            let count = 2;
            let j = i + 1;
            while (chartData[j] === chartData[i]) {
                count++;
                j++;
            }
            streaks.push(`${chartData[i]} (${count} láº§n liÃªn tiáº¿p)`);
            i = j - 1;
        }
    }
    const streakInfo = streaks.length > 0 ? streaks.join(', ') : 'KhÃ´ng cÃ³';

    container.innerHTML = `
        ğŸ“Š <strong>Trung bÃ¬nh cá»™ng:</strong> ${average}<br>
        ğŸ“ˆ <strong>Xu hÆ°á»›ng 5 sá»‘ gáº§n nháº¥t:</strong> ${last5.join(', ')} â†’ <em>${trend5}</em><br>
        ğŸ“ˆ <strong>PhÃ¢n bá»‘ sá»‘:</strong> ${globalTrend}<br>
        ğŸ“Œ <strong>CÃ¡c sá»‘ ra á»•n Ä‘á»‹nh (â‰¥ 2 láº§n):</strong> ${mostStable}<br>
        ğŸ”¢ <strong>Top 3 sá»‘ ra nhiá»u nháº¥t:</strong> ${top3}<br>
        ğŸ“Š <strong>Tá»· lá»‡ nhÃ³m:</strong> Nhá» ${percent(small)} â€“ HÃ²a ${percent(draw)} â€“ Lá»›n ${percent(big)}<br>
        ğŸ” <strong>Chuá»—i sá»‘ láº·p liÃªn tiáº¿p:</strong> ${streakInfo}
    `;
}

    function updateMiniChart() {
  const containerId = 'miniChartContainer';
  if (!document.getElementById(containerId)) {
    const container = document.createElement('div');
    container.id = containerId;
    container.style.marginTop = '20px';
    container.style.background = '#fff';
    container.style.padding = '10px';
    container.style.borderRadius = '12px';
    container.style.boxShadow = '0 2px 6px rgba(0,0,0,0.1)';
    container.innerHTML = `<h4>ğŸ“Š Táº§n suáº¥t xuáº¥t hiá»‡n</h4><canvas id="miniChart" height="200"></canvas>`;
    document.getElementById('right').appendChild(container);
  }
  const ctx = document.getElementById('miniChart').getContext('2d');
  const freq = {};
  for (let i = 3; i <= 18; i++) freq[i] = 0;
  chartData.forEach(n => freq[n]++);
  const labels = Object.keys(freq);
  const values = Object.values(freq);
  if (miniChart) miniChart.destroy();
  miniChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Sá»‘ láº§n xuáº¥t hiá»‡n',
        data: values,
        backgroundColor: '#42a5f5'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { stepSize: 1 }
        }
      }
    }
  });
}
    
  function updateStrategy() {
  const containerId = 'strategyAdvice';
  let container = document.getElementById(containerId);
  if (!container) {
    container = document.createElement('div');
    container.id = containerId;
    container.style.marginTop = '20px';
    container.style.padding = '15px';
    container.style.background = '#e8f5e9';
    container.style.border = '1px solid #a5d6a7';
    container.style.borderRadius = '8px';
    container.style.lineHeight = '1.6';
    container.innerHTML = `<h4>ğŸ’° Chiáº¿n thuáº­t Ä‘á» xuáº¥t (theo tá»‰ lá»‡ tráº£ thÆ°á»Ÿng)</h4><div id="strategyText"></div>`;

    const extraStats = document.getElementById('extraStats');
    if (extraStats) {
      extraStats.insertAdjacentElement('afterend', container);
    } else {
      document.getElementById('right').appendChild(container);
    }
  }

  // Thá»‘ng kÃª táº§n suáº¥t
  const count = {};
  for (let i = 3; i <= 18; i++) count[i] = 0;
  chartData.forEach(n => count[n]++);
  const sorted = Object.entries(count).sort((a, b) => a[1] - b[1]);
  const rareCandidates = sorted.slice(0, 3).map(([n]) => parseInt(n));
  const bestReturns = rareCandidates.sort((a, b) => payoutMap[b] - payoutMap[a]);

  // Dá»±a vÃ o nhÃ³m sá»‘ gáº§n nháº¥t
  const last10 = chartData.slice(-10);
  let small = 0, draw = 0, large = 0;
  last10.forEach(n => {
    if (n <= 9) small++;
    else if (n <= 11) draw++;
    else large++;
  });

  // NhÃ³m xuáº¥t hiá»‡n Ã­t nháº¥t trong 10 lÆ°á»£t gáº§n nháº¥t
  const groupGaps = {
    'Nhá»': small,
    'HÃ²a': draw,
    'Lá»›n': large
  };
  const recommendGroup = Object.entries(groupGaps).sort((a, b) => a[1] - b[1])[0][0];

  // Sá»‘ cuá»‘i cÃ¹ng Ä‘á»ƒ lÃ m chiáº¿n thuáº­t chu ká»³
  const last = chartData[chartData.length - 1];
  let counterGroup = '';
  if (last <= 9) counterGroup = 'Lá»›n (12â€“18)';
  else if (last <= 11) counterGroup = 'Nhá» (3â€“9)';
  else counterGroup = 'HÃ²a (10â€“11)';

  document.getElementById('strategyText').innerHTML = `
    ğŸ¯ <strong>Sá»‘ hiáº¿m gáº§n Ä‘Ã¢y:</strong> ${rareCandidates.join(', ')}<br>
    ğŸ§® <strong>Æ¯u tiÃªn chá»n sá»‘:</strong> ${bestReturns.join(', ')} (tá»‰ lá»‡ tháº¯ng cao + Ã­t xuáº¥t hiá»‡n)<br>
    ğŸ“‰ <strong>NhÃ³m sá»‘ xuáº¥t hiá»‡n Ã­t trong 10 lÆ°á»£t gáº§n nháº¥t:</strong> <span style="color: darkorange">${recommendGroup}</span> â€“ chá»‰ xuáº¥t hiá»‡n ${groupGaps[recommendGroup]} láº§n â†’ cÃ³ thá»ƒ cÃ¢n nháº¯c<br>
    ğŸ” <strong>Chiáº¿n thuáº­t Ä‘á»•i nhÃ³m:</strong> Sau khi ra ${last}, thá»­ chuyá»ƒn sang nhÃ³m Ä‘á»‘i láº­p: <strong>${counterGroup}</strong><br>
    âš–ï¸ <strong>Gá»£i Ã½:</strong> Káº¿t há»£p chá»n sá»‘ hiáº¿m vÃ  cÆ°á»£c theo nhÃ³m Ã­t ra â†’ tÄƒng xÃ¡c suáº¥t lá»£i nhuáº­n.
  `;
}

  function updateAIRecommendation() {
      let container = document.getElementById('aiRecommendation');
      if (!container) {
        container = document.createElement('div');
        container.id = 'aiRecommendation';
        container.style.marginTop = '20px';
        container.style.padding = '10px';
        container.style.background = '#e3f2fd';
        container.style.border = '1px solid #90caf9';
        container.style.borderRadius = '8px';
        container.innerHTML = `<h4>ğŸ¤– Gá»£i Ã½ AI (Dá»±a trÃªn biáº¿n Ä‘á»™ng)</h4><div id="aiContent"></div>`;
        const profitBox = document.getElementById('profitEstimation');
        profitBox.insertAdjacentElement('afterend', container);
      }
      if (chartData.length < 5) {
        document.getElementById('aiContent').innerHTML = `Cáº§n Ã­t nháº¥t 5 sá»‘ Ä‘á»ƒ AI phÃ¢n tÃ­ch.`;
        return;
      }
      const recent = chartData.slice(-5);
      const freq = {};
      for (let i = 3; i <= 18; i++) freq[i] = 0;
      chartData.forEach(n => freq[n]++);
      const lowFreq = Object.entries(freq).filter(([k, v]) => v <= 1).map(([k]) => parseInt(k));
      const nextSuggest = lowFreq.sort((a, b) => payoutMap[b] - payoutMap[a]).slice(0, 3);

      let trend = 'khÃ´ng á»•n Ä‘á»‹nh';
      if (recent.every((v, i, arr) => i === 0 || v > arr[i - 1])) trend = 'tÄƒng';
      else if (recent.every((v, i, arr) => i === 0 || v < arr[i - 1])) trend = 'giáº£m';

      document.getElementById('aiContent').innerHTML = `
        ğŸ“ˆ Xu hÆ°á»›ng 5 sá»‘ gáº§n nháº¥t: <strong>${trend}</strong><br>
        ğŸ¯ Dá»± Ä‘oÃ¡n sá»‘ cÃ³ thá»ƒ ra tiáº¿p theo: <strong>${nextSuggest.join(', ')}</strong> (payout cao, Ã­t xuáº¥t hiá»‡n)
      `;
  }

    function resetAll() {
      chartData = [];
      document.getElementById('numberInput').value = '';
      document.getElementById('resultArea').innerHTML = '';
      document.getElementById('predictionArea').innerHTML = '';
      lineChart.data.labels = [];
      lineChart.data.datasets[0].data = [];
      lineChart.update();
    }

    document.getElementById('numberInput').addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault(); // NgÄƒn form bá»‹ reload (náº¿u cÃ³)
        processInput();
      }
    });

    updateChartSize();
  </script>
</body>
</html>
